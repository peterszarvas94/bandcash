{{define "index"}}
<!doctype html>
<html lang="en">
  {{template "head" .}}
  <body>
    <div
      data-signals="{view: '/entry', editingEntryId: 0, addingEntry: false, newEntry: {title: '', time: '', description: '', amount: 0}, entries: {{.EntriesJSON}}}"
      data-init="@get('/sse')"
    ></div>
    {{block "app" .}}
    <main id="app">
      <h1>{{.Title}}</h1>
      {{template "breadcrumbs" .}}
      <table class="table">
        <thead>
          <tr>
            <th>Title</th>
            <th>Time</th>
            <th>Description</th>
            <th>Amount</th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody>
          {{range .Entries}}
          <tr data-show="$editingEntryId !== {{.ID}}" style="display: none">
            <td><a href="/entry/{{.ID}}">{{.Title}}</a></td>
            <td>{{.Time}}</td>
            <td>{{.Description}}</td>
            <td class="text-right">{{printf "%d" .Amount}}</td>
            <td>
              <div class="row" data-show="$editingEntryId === 0 && !$addingEntry">
                <button
                  type="button"
                  data-on:click="$editingEntryId = {{.ID}}"
                >
                  Edit
                </button>
                <button
                  data-on:click="if (window.confirm('Delete this entry?')) { @delete('/entry/{{.ID}}') }"
                >
                  Delete
                </button>
              </div>
            </td>
          </tr>
          <tr data-show="$editingEntryId === {{.ID}}" style="display: none">
            <td>
              <input type="text" data-bind="entries.{{.ID}}.title" required />
            </td>
            <td>
              <input
                type="datetime-local"
                data-bind="entries.{{.ID}}.time"
                required
              />
            </td>
            <td>
              <input type="text" data-bind="entries.{{.ID}}.description" />
            </td>
            <td class="text-right">
              <input
                type="number"
                data-bind="entries.{{.ID}}.amount"
                step="1"
                required
              />
            </td>
            <td>
              <div class="row">
                <button type="button" data-on:click="@put('/entry/{{.ID}}?inline=1')">
                  Save
                </button>
                <button
                  type="button"
                  data-on:click="$editingEntryId = 0"
                >
                  Cancel
                </button>
              </div>
            </td>
          </tr>
          {{end}}
          <tr data-show="$addingEntry" style="display: none">
            <td>
              <input type="text" data-bind="newEntry.title" required />
            </td>
            <td>
              <input
                type="datetime-local"
                data-bind="newEntry.time"
                required
              />
            </td>
            <td>
              <input type="text" data-bind="newEntry.description" />
            </td>
            <td class="text-right">
              <input
                type="number"
                data-bind="newEntry.amount"
                step="1"
                required
              />
            </td>
            <td>
              <div class="row">
                <button type="button" data-on:click="@post('/entry?inline=1')">
                  Save
                </button>
                <button
                  type="button"
                  data-on:click="$addingEntry = false; $newEntry = {title: '', time: '', description: '', amount: 0}"
                >
                  Cancel
                </button>
              </div>
            </td>
          </tr>
        </tbody>
      </table>

      <p class="row pb" data-show="$editingEntryId === 0 && !$addingEntry">
        <button type="button" data-on:click="$addingEntry = true">
          Add entry
        </button>
      </p>
    </main>
    {{end}}
  </body>
</html>
{{end}}
