# Bandcash

Bandcash is a Go web app for shared group expenses.

- Stack: Go, Echo, Datastar, templ, SQLite, sqlc, goose
- Entrypoint: `cmd/server/main.go`

## Quick Start

```bash
mise trust
mise install
mise run goose-up
mise run dev
```

Dev works out of the box using committed `.kamal/secrets.dev`.

Open `http://localhost:2222`.

## Deployment (Kamal)

1) Create `.kamal/secrets` on your machine/server (this file is ignored by git) and set at least:

```dotenv
KAMAL_REGISTRY_USERNAME=
KAMAL_REGISTRY_PASSWORD=
BETTER_STACK_URI=
BETTER_STACK_SOURCE_TOKEN=

APP_ENV=production
PORT=2222
URL=https://bandcash.app
DB_PATH=/storage/sqlite.db
LOG_LEVEL=info
LOG_FOLDER=/storage/logs
LOG_PREFIX=bandcash
DISABLE_SIGNUP=true
DISABLE_RATE_LIMIT=false

SMTP_USERNAME=
SMTP_PASSWORD=
SMTP_HOST=
SMTP_PORT=
EMAIL_FROM="BandCash <noreply@bandcash.app>"
```

2) Ensure SSH host alias `bandcash` is configured and reachable.

3) Run deploy via mise:

```bash
mise run kamal deploy
```

Useful commands:

```bash
mise run kamal setup
mise run kamal app logs
mise run kamal app details
```

## Common Commands

```bash
mise run dev          # hot reload
mise run run          # run server directly
mise run build        # build binary (tmp/server)
mise run test         # go test -v ./...
mise run format       # go fmt ./...
mise run vet          # go vet ./...
mise run lint         # golangci-lint run
mise run templ        # regenerate *_templ.go
mise run sqlc         # regenerate sqlc output
mise run goose-up     # apply migrations
mise run goose-status # migration status
mise run seed         # seed local data
mise run mailpit      # local SMTP catch-all UI (http://localhost:8025)
```

## Project Layout

- `cmd/server/` - app bootstrap and route wiring
- `models/` - feature modules (`auth`, `group`, `event`, `member`, `settings`, `dev`)
- `internal/` - shared packages (`db`, `middleware`, `utils`, `i18n`, `email`)
- `internal/db/migrations/` - goose migrations
- `internal/db/queries/` - sqlc query sources
- `static/` - CSS and JS assets

## Notes

- Do not edit generated files directly:
  - `*_templ.go` (generated by `mise run templ`)
  - `internal/db/*.sql.go` (generated by `mise run sqlc`)
- Agent-specific implementation guidance lives in `AGENTS.md`.
- Local dev env loads from committed `.kamal/secrets.dev`.
- Production env and deploy secrets come from `.kamal/secrets`.
- Better Stack sink URI and token are both loaded from secrets.

## License

[O’Saasy](https://osaasy.dev/) © 2026 Peter Szarvas. See `LICENSE.md`.
